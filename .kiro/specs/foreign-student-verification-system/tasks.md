# 外國學生受教權查核系統實作計劃

- [x] 1. 建立專案結構和核心介面
  - 建立前端和後端的目錄結構
  - 設定TypeScript配置和基本依賴套件
  - 定義核心資料類型和介面
  - 建立基本的專案配置檔案（package.json、tsconfig.json等）
  - _需求: 1.1, 2.1, 3.1_

- [x] 2. 實作資料模型和資料庫架構
- [x] 2.1 建立資料庫schema和遷移檔案
  - 撰寫PostgreSQL資料表建立腳本
  - 實作資料庫遷移系統
  - 建立索引和約束條件
  - _需求: 1.5, 3.2, 4.2_

- [x] 2.2 實作核心資料模型類別
  - 建立Student、User、Unit、DocumentType等實體類別
  - 實作資料驗證和序列化方法
  - 建立實體間的關聯關係
  - _需求: 1.5, 3.2, 6.2_

- [x] 2.3 建立資料存取層（Repository Pattern）
  - 實作基礎Repository介面和抽象類別
  - 建立各實體的具體Repository實作
  - 實作CRUD操作和複雜查詢方法
  - _需求: 3.2, 4.3, 6.3_

- [x] 2.4 撰寫資料模型單元測試
  - 建立資料驗證測試
  - 測試實體關聯關係
  - 測試Repository操作
  - _需求: 1.5, 3.2_

- [x] 3. 實作身份驗證和授權系統
- [x] 3.1 建立JWT認證服務和中介軟體
  - 實作JWT token產生和驗證服務
  - 建立身份驗證中介軟體
  - 實作token刷新機制
  - _需求: 1.1, 2.1_

- [x] 3.2 實作使用者認證API端點
  - 建立登入API端點（支援本地和LDAP認證）
  - 建立登出和token刷新端點
  - 實作使用者資訊查詢API
  - _需求: 1.1, 2.1_

- [x] 3.3 實作角色和權限管理中介軟體
  - 建立權限控制中介軟體
  - 實作單位別權限檢查邏輯
  - 建立角色驗證裝飾器
  - _需求: 2.2, 2.3, 2.4, 2.5_

- [x] 3.4 撰寫認證授權測試
  - 測試JWT token功能
  - 測試權限控制邏輯
  - 測試API端點安全性
  - _需求: 1.1, 2.1_

- [x] 4. 整合認證路由到主應用程式
  - 在backend/src/index.ts中整合auth routes
  - 初始化資料庫連線池
  - 設定路由前綴（/api/auth）
  - 測試認證端點是否正常運作
  - _需求: 1.1, 2.1_

- [x] 5. 建立檔案上傳和管理系統
- [x] 5.1 實作檔案上傳服務和中介軟體
  - 建立檔案上傳中介軟體（使用multer）
  - 實作檔案格式驗證和大小限制
  - 建立檔案儲存服務（本地或雲端）
  - _需求: 1.2, 1.3_

- [x] 5.2 建立文件管理服務和控制器
  - 實作DocumentService處理文件業務邏輯
  - 建立DocumentController處理API請求
  - 實作文件上傳、下載、刪除和更新功能
  - _需求: 1.2, 1.4_

- [x] 5.3 建立文件管理API路由
  - 實作文件上傳API端點（POST /api/documents/upload）
  - 建立文件下載和預覽API（GET /api/documents/:id）
  - 實作文件刪除和更新API（DELETE/PUT /api/documents/:id）
  - 整合權限控制確保只有授權單位可上傳
  - _需求: 1.2, 1.4_

- [x] 5.4 實作網頁連結管理功能
  - 建立URL驗證和儲存邏輯
  - 實作連結有效性檢查服務
  - 建立連結管理API端點（POST /api/documents/link）
  - _需求: 1.2, 3.5_

- [x] 5.5 撰寫檔案管理測試
  - 測試檔案上傳功能
  - 測試檔案驗證邏輯
  - 測試API端點功能
  - _需求: 1.2, 1.3_

- [x] 6. 實作學生檔案管理功能
- [x] 6.1 建立學生資料管理服務和控制器
  - 實作StudentService處理學生業務邏輯
  - 建立StudentController處理API請求
  - 實作學生搜尋和篩選邏輯
  - _需求: 3.1, 3.2, 5.1_

- [x] 6.2 建立學生資料管理API路由
  - 實作學生基本資料CRUD API端點
  - 建立學生搜尋和篩選API（GET /api/students）
  - 實作學生資料批量匯入功能（POST /api/students/import）
  - _需求: 3.1, 3.2, 5.1_

- [x] 6.3 實作學生文件關聯管理API
  - 建立學生文件關聯API端點（GET /api/students/:id/documents）
  - 實作文件狀態更新功能（PUT /api/students/:id/documents/:docId/status）
  - 建立完成度計算API（GET /api/students/:id/completion）
  - _需求: 3.2, 3.4, 5.2_

- [x] 6.4 建立學生檔案查看API
  - 實作以學生為中心的資料展示API（GET /api/students/:id/profile）
  - 建立文件清單和詳細資訊API
  - 實作資料完成度統計API
  - _需求: 3.1, 3.2, 5.1, 5.2_

- [x] 6.5 撰寫學生檔案管理測試
  - 測試學生資料CRUD操作
  - 測試文件關聯邏輯
  - 測試完成度計算
  - _需求: 3.1, 5.1_

- [x] 7. 實作追蹤記錄和稽核系統
- [x] 7.1 建立操作記錄追蹤服務
  - 實作TrackingService處理追蹤記錄
  - 建立自動記錄中介軟體
  - 實作操作歷程查詢API（GET /api/tracking）
  - _需求: 4.1, 4.2, 4.3_

- [x] 7.2 實作稽核報表功能
  - 建立ReportService產生報表
  - 實作資料篩選和統計API（GET /api/reports/audit）
  - 建立報表匯出API端點（GET /api/reports/export）
  - _需求: 4.4, 6.4, 6.5_

- [x] 7.3 撰寫追蹤系統測試
  - 測試操作記錄功能
  - 測試報表產生邏輯
  - 測試資料統計準確性
  - _需求: 4.1, 4.4_

- [x] 8. 建立通知和提醒系統
- [x] 8.1 實作通知服務
  - 建立NotificationService處理通知邏輯
  - 實作電子郵件通知服務（整合nodemailer）
  - 建立系統內通知機制
  - 建立通知API端點（GET/POST /api/notifications）
  - _需求: 5.5, 6.5_

- [x] 8.2 實作自動提醒功能
  - 建立排程任務系統（使用node-cron）
  - 實作逾期提醒邏輯
  - 建立提醒規則配置API（GET/PUT /api/notifications/settings）
  - _需求: 5.5_

- [x] 8.3 撰寫通知系統測試
  - 測試郵件發送功能
  - 測試提醒排程邏輯
  - 測試通知API
  - _需求: 5.5_

- [x] 9. 開發前端使用者介面
- [x] 9.1 建立前端狀態管理和API服務
  - 使用Zustand建立全域狀態管理（auth、student、document stores）
  - 建立API服務層（axios配置、API client）
  - 實作請求攔截器處理JWT token
  - 建立錯誤處理和通知機制
  - _需求: 1.1, 2.1, 3.1_

- [x] 9.2 實作使用者認證介面
  - 建立登入頁面和表單驗證
  - 實作使用者資訊顯示元件
  - 建立權限控制的導航選單
  - 實作受保護路由（ProtectedRoute component）
  - _需求: 1.1, 2.1_

- [x] 9.3 建立共用UI元件庫
  - 建立Layout元件（Header、Sidebar、Footer）
  - 實作響應式佈局
  - 建立共用表單元件（Input、Select、DatePicker等）
  - 建立Loading和Error元件
  - _需求: 1.1, 2.1, 3.1_

- [x] 9.4 建立文件上傳介面
  - 實作拖拉上傳元件（使用Ant Design Upload）
  - 建立上傳進度和狀態顯示
  - 實作網頁連結輸入表單
  - 建立文件預覽功能
  - _需求: 1.2, 1.4_

- [x] 9.5 實作學生檔案管理介面
  - 建立學生搜尋和篩選介面
  - 實作學生列表頁面（含分頁和排序）
  - 建立學生資料詳細頁面
  - 實作文件清單和狀態顯示元件
  - 建立完成度進度條元件
  - _需求: 3.1, 3.2, 5.1_

- [x] 9.6 建立管理和報表介面
  - 實作進度監控儀表板（使用圖表顯示統計）
  - 建立稽核報表查看介面
  - 實作資料匯出功能介面
  - 建立追蹤記錄查詢介面
  - _需求: 4.3, 6.3, 6.4_

- [x] 9.7 撰寫前端元件測試
  - 建立UI元件單元測試
  - 測試使用者互動邏輯
  - 測試表單驗證功能
  - _需求: 1.1, 1.2_

- [x] 10. 系統整合和優化
- [x] 10.1 實作統一錯誤處理機制
  - 建立全域錯誤處理中介軟體
  - 實作標準化錯誤回應格式
  - 建立錯誤日誌記錄系統（使用winston）
  - _需求: 1.1, 1.2, 3.1_

- [x] 10.2 實作快取和效能優化
  - 整合Redis快取機制
  - 實作API回應快取策略
  - 優化資料庫查詢效能（索引、查詢優化）
  - _需求: 3.1, 3.2_

- [x] 10.3 建立整合測試套件
  - 建立完整的API整合測試
  - 測試前後端資料流
  - 驗證系統整體功能
  - _需求: 1.1, 2.1, 3.1_

- [x] 11. 部署配置和系統完善
- [x] 11.1 完善Docker容器化配置
  - 優化現有Dockerfile和docker-compose
  - 建立生產環境配置
  - 實作健康檢查端點
  - 設定環境變數管理
  - _需求: 所有需求_

- [x] 11.2 建立部署文件和腳本
  - 撰寫部署指南文件
  - 建立資料庫初始化腳本
  - 撰寫系統維護文件
  - _需求: 所有需求_

- [x] 12. 實作文件狀態審核功能
- [x] 12.1 建立前端文件狀態更新服務
  - 在document.service.ts中新增updateDocumentStatus方法
  - 實作API呼叫邏輯（PUT /api/documents/:id/status）
  - 處理錯誤和成功回應
  - _需求: 7.2, 7.3_

- [x] 12.2 建立文件狀態更新UI元件
  - 建立DocumentStatusModal元件用於更新狀態
  - 實作狀態選擇下拉選單（待審核、審核中、已核准、已拒絕）
  - 新增備註輸入欄位（拒絕時必填）
  - 實作狀態更新確認對話框
  - _需求: 7.1, 7.2, 7.4_

- [x] 12.3 整合狀態更新功能到文件列表
  - 在DocumentList元件中新增狀態更新按鈕
  - 實作權限控制（只有審核人員可更新狀態）
  - 更新後自動重新載入文件列表
  - 顯示狀態更新成功/失敗訊息
  - _需求: 7.1, 7.2, 7.3_

- [x] 12.4 優化文件狀態顯示
  - 更新狀態標籤顏色和圖示
  - 顯示審核者和審核時間資訊
  - 新增狀態篩選功能
  - _需求: 7.1_